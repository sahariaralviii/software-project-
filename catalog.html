<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Our Catalog - Walk & Go BookStore</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- QR Scanner Library -->
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <style>
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
        }
        .navbar-brand {
            font-weight: 600;
        }
        .book-card {
            border: none;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.07);
            transition: all 0.3s ease;
            height: 100%;
            background-color: #fff;
            display: flex;
            flex-direction: column;
        }
        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .book-card-img-container {
            position: relative;
            cursor: pointer;
        }
        .book-card img {
            height: 350px;
            object-fit: cover;
            width: 100%;
        }
        .discount-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background-color: #dc3545;
            color: #fff;
            font-size: 0.8rem;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 6px;
        }
        .category-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background-color: rgba(0, 0, 0, 0.5);
            color: #fff;
            font-size: 0.75rem;
            font-weight: 500;
            padding: 4px 10px;
            border-radius: 50px;
        }
        .book-card-body {
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        .book-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: #212529;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .book-author {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 1rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .rating-stars {
            color: #ffc107;
            font-size: 0.9rem;
        }
        .review-count {
            font-size: 0.85rem;
            color: #6c757d;
            margin-left: 0.5rem;
        }
        .price-new {
            font-size: 1.25rem;
            font-weight: 700;
            color: #d63384;
        }
        .price-old {
            font-size: 0.95rem;
            color: #6c757d;
            text-decoration: line-through;
            margin-left: 0.5rem;
        }
        .book-card .btn {
            margin-top: auto;
            font-weight: 600;
            border-radius: 8px;
        }
        .modal-book-img {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: 12px;
        }
        #qr-reader video {
            width: 100% !important;
            height: auto !important;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        #cartItemsList {
            max-height: 60vh;
            overflow-y: auto;
        }
        
    </style>
</head>
<body>

    <!-- Navbar (Corrected Links and Added Scan/Cart/User) -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">ðŸ“š Just Walk & Go BookStore</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navMenu">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-center">
                    <li class="nav-item"><a class="nav-link" href="C:\Users\LaptopAid\Downloads\bookstore management\login.html">Login</a></li>
                    <li class="nav-item"><a class="nav-link" href="C:\Users\LaptopAid\Downloads\bookstore management\home.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link active" href="C:\Users\LaptopAid\Downloads\bookstore management\catalog.html">Catalog</a></li>
                    <li class="nav-item"><a class="nav-link" href="C:\Users\LaptopAid\Downloads\bookstore management\catagories.html">Categories</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">About</a></li>
                    
                    <!-- Added Scan Button -->
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="openScannerBtn">
                            <i class="bi bi-qr-code-scan"></i> Scan
                        </a>
                    </li>
                    <!-- Added Cart Button -->
                    <li class="nav-item">
                        <a class="nav-link position-relative" href="#" id="cartBtn">
                            <i class="bi bi-cart"></i> Cart
                            <span id="cartCountBadge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none;">
                                0
                            </span>
                        </a>
                    </li>
                     <!-- Added User Name Display -->
                    <li class="nav-item">
                        <span class="navbar-text ms-lg-2" id="userNameDisplay">Demo User</span>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container py-5">
        
        <!-- Header -->
        <div class="text-center mb-5">
            <h2 class="display-5 fw-bold">Browse Our Catalog</h2>
            <p class="lead text-muted">Find your perfect book from our extensive collection</p>
        </div>

        <!-- Filters / Info Bar -->
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4">
            <!-- Category Filter Dropdown -->
            <div class="dropdown">
                <button class="btn btn-outline-dark dropdown-toggle" type="button" data-bs-toggle="dropdown" id="categoryDropdownButton">
                    All Categories
                </button>
                <ul class="dropdown-menu" id="categoryDropdownMenu">
                    <!-- Categories will be populated by JS -->
                </ul>
            </div>
            
            <!-- Book Count -->
            <div class="text-muted mt-3 mt-md-0">
                <span id="book-count">Showing 26 of 26 books</span>
            </div>
        </div>

        <!-- Book Grid -->
        <div id="book-grid" class="row g-4">
            <!-- Book cards will be populated by JS -->
        </div>

    </main>
    
    <!-- ================================== -->
    <!--            MODALS                  -->
    <!-- ================================== -->

    <!-- 1. Book Details Modal (Original) -->
    <div class="modal fade" id="bookModal" tabindex="-1" aria-labelledby="bookModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title" id="modalBookTitle">Book Title</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modalBookBody">
                    <div class="row">
                        <div class="col-md-5">
                            <img src="https://placehold.co/400x600/eee/ccc?text=Book+Cover" id="modalBookImage" class="modal-book-img" alt="Book Cover">
                        </div>
                        <div class="col-md-7">
                            <h3 id="modalBookAuthor" class="text-muted fw-normal">Author Name</h3>
                            <div class="d-flex align-items-center mb-3">
                                <span id="modalBookRating" class="rating-stars"></span>
                                <span id="modalBookReviews" class="review-count">(0 reviews)</span>
                            </div>
                            <span id="modalBookCategory" class="badge bg-primary mb-3">Category</span>
                            <p id="modalBookDescription">
                                Details for this book are not available yet.
                            </p>
                            <div class="mb-3">
                                <span id="modalBookPriceNew" class="price-new">$0.00</span>
                                <span id="modalBookPriceOld" class="price-old">$0.00</span>
                            </div>
                            <button class="btn btn-primary btn-lg w-100" id="modalAddToCartButton">
                                <i class="bi bi-cart-plus"></i> Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. QR Scanner Modal (NEW) -->
    <div class="modal fade" id="scannerModal" tabindex="-1" aria-labelledby="scannerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="scannerModalLabel">Scan Book QR Code</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="qr-reader" class="w-100"></div>
                    <p id="qr-scan-result" class="text-center text-muted mt-3"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. Cart Modal (NEW) -->
    <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cartModalLabel">Your Cart</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="cartItemsList">
                        <p id="emptyCartMsg" class="text-center text-muted py-4">Your cart is empty.</p>
                        <!-- Cart items will be injected here by JS -->
                    </div>
                </div>
                <div class="modal-footer justify-content-between">
                    <div>
                        <span class="fs-5 fw-bold">Total:</span>
                        <span id="cartTotal" class="fs-4 fw-bold text-primary ms-2">$0.00</span>
                    </div>
                    <div>
                        <button id="clearCartBtn" class="btn btn-outline-danger" disabled>Clear Cart</button>
                        <button id="checkoutBtn" class="btn btn-primary" disabled>Checkout</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. Custom Alert Modal (NEW) -->
    <div class="modal fade" id="alertModal" tabindex="-1" aria-labelledby="alertModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center p-4">
                    <p id="alertMessage" class="fs-5 mb-4">This is an alert message.</p>
                    <button type="button" class="btn btn-primary w-100" data-bs-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JavaScript (Fully Corrected and Implemented) -->
    <script>
        
        // --- CART PERSISTENCE ---
        const CART_STORAGE_KEY = 'bookstore_cart';

        function getCartFromStorage() {
            return JSON.parse(localStorage.getItem(CART_STORAGE_KEY)) || [];
        }

        function saveCartToStorage() {
            localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
        }

        // --- All 26 Books Data (with descriptions) ---
        const allBooks = [
            { _id: '1', title: 'To Kill a Mockingbird', author: 'Harper Lee', category: 'Classic Literature', rating: 4.8, reviews: 2847, price: 12.99, oldPrice: 15.99, discount: 19, image: 'https://plus.unsplash.com/premium_photo-1667239039514-a6e7cab0a27b?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MXx8VG8lMjBLaWxsJTIwYSUyME1vY2tpbmdiaXJkJTIwSGFycGVyJTIwTGVlfGVufDB8fDB8fHww&auto=format&fit=crop&q=60&w=600', description: "A gripping, heart-wrenching, and wholly remarkable tale of coming-of-age in a South poisoned by virulent prejudice." },
            { _id: '2', title: 'The Seven Husbands of Evelyn Hugo', author: 'Taylor Jenkins Reid', category: 'Contemporary Fiction', rating: 4.9, reviews: 4521, price: 16.99, oldPrice: 19.99, discount: 15, image: 'https://images.unsplash.com/photo-1581593439200-22e0fe84faed?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8VGhlJTIwU2V2ZW4lMjBIdXNiYW5kcyUyMG9mJTIwRXZlbHluJTIwSHVnbyUyMFRheWxvciUyMEplbmtpbnMlMjBSZWlkfGVufDB8fDB8fHww&auto=format&fit=crop&q=60&w=600', description: "A mesmerizing novel about the life of a reclusive Hollywood icon who finally tells her story to a young journalist." },
            { _id: '3', title: 'Dune', author: 'Frank Herbert', category: 'Science Fiction', rating: 4.7, reviews: 3284, price: 18.99, oldPrice: null, discount: 0, image: 'https://images.unsplash.com/photo-1651765449829-302290944bb0?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8RHVuZSUyMEZyYW5rJTIwSGVyYmVyfGVufDB8fDB8fHww&auto=format&fit=crop&q=60&w=600', description: "Set on the desert planet Arrakis, this epic tale follows young Paul Atreides as he navigates political intrigue and mystical powers." },
            { _id: '4', title: 'Atomic Habits', author: 'James Clear', category: 'Self-Help', rating: 4.8, reviews: 5672, price: 14.99, oldPrice: 17.99, discount: 17, image: 'https://images.unsplash.com/photo-1643205942704-b6bb6d3115f1?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MXx8QXRvbWljJTIwSGFiaXRzJTIwSmFtZXMlMjBDbGVhfGVufDB8fDB8fHww&auto=format&fit=crop&q=60&w=600', description: "A comprehensive guide to building good habits and breaking bad ones through tiny changes that lead to remarkable results." },
            { _id: '5', title: 'The Midnight Library', author: 'Matt Haig', category: 'Contemporary Fiction', rating: 4.6, reviews: 2891, price: 13.99, oldPrice: null, discount: 0, image: 'https://plus.unsplash.com/premium_photo-1749725906334-3156b4484d0b?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MXx8VGhlJTIwTWlkbmlnaHQlMjBMaWJyYXJ5JTIwTWF0dCUyMEhhaWd8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&q=60&w=600', description: "Between life and death there is a library, where each book represents a different life you could have lived." },
            { _id: '6', title: '1984', author: 'George Orwell', category: 'Classic Literature', rating: 4.7, reviews: 4156, price: 11.99, oldPrice: null, discount: 0, image: 'https://plus.unsplash.com/premium_photo-1663954129804-b372935b861c?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&q=80&w=427', description: "A dystopian masterpiece that explores themes of totalitarianism, surveillance, and the manipulation of truth." },
            { _id: '7', title: 'à¦—à§‹à¦°à¦¾ (Gora)', author: 'à¦°à¦¬à§€à¦¨à§à¦¦à§à¦°à¦¨à¦¾à¦¥ à¦ à¦¾à¦•à§à¦° (Rabindranath Tagore)', category: 'Bangla Literature', rating: 4.9, reviews: 1523, price: 8.99, oldPrice: 10.99, discount: 18, image: 'https://images.unsplash.com/photo-1713861676101-03359fd0cd6b?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTR8fCVFMCVBNiU5NyVFMCVBNyU4QiVFMCVBNiVCMCVFMCVBNiVCRSUyMChHb3JhKSUyMCVFMCVBNiVCMCVFMCVBNiVBQyVFMCVBNyU4MCVFMCVBNiVBOCVFMCVBNyU4RCVFMCVBNiVBNiVFMCVBNyU4RCVFMCVBNiVCMCVFMCVBNiVBOCVFMCVBNiVCRSVFMCVBNiVBNSUyMCVFMCVBNiVBMCVFMCVBNiVCRSVFMCVBNiU5NSVFMCVBNyU4MSVFMCVBNiVCMCUyMChSYWJpbmRyYW5hdGglMjBUYWdvcmUpfGVufDB8fDB8fHww&auto=format&fit=crop&q=60&w=600', description: "à¦°à¦¬à§€à¦¨à§à¦¦à§à¦°à¦¨à¦¾à¦¥ à¦ à¦¾à¦•à§à¦°à§‡à¦° à¦à¦•à¦Ÿà¦¿ à¦…à¦¸à¦¾à¦§à¦¾à¦°à¦£ à¦‰à¦ªà¦¨à§à¦¯à¦¾à¦¸ à¦¯à¦¾ à¦œà¦¾à¦¤à§€à¦¯à¦¼à¦¤à¦¾à¦¬à¦¾à¦¦, à¦§à¦°à§à¦® à¦à¦¬à¦‚ à¦®à¦¾à¦¨à¦¬à¦¿à¦• à¦¸à¦®à§à¦ªà¦°à§à¦•à§‡à¦° à¦œà¦Ÿà¦¿à¦²à¦¤à¦¾ à¦¨à¦¿à¦¯à¦¼à§‡ à¦†à¦²à§‹à¦šà¦¨à¦¾ à¦•à¦°à§‡à¥¤ A masterpiece exploring nationalism, religion, and human relationships in colonial Bengal." },
            { _id: '8', title: 'à¦ªà¦¦à§à¦®à¦¾ à¦¨à¦¦à§€à¦° à¦®à¦¾à¦à¦¿ (Padma Nadir Majhi)', author: 'à¦®à¦¾à¦¨à¦¿à¦• à¦¬à¦¨à§à¦¦à§à¦¯à§‹à¦ªà¦¾à¦§à§à¦¯à¦¾à¦¯à¦¼ (Manik Bandopadhyay)', category: 'Bangla Literature', rating: 4.7, reviews: 956, price: 7.50, oldPrice: null, discount: 0, image: 'https://images.unsplash.com/photo-1715516769214-1fcb2078b643?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTh8fCVFMCVBNiVBQSVFMCVBNiVBNiVFMCVBNyU4RCVFMCVBNiVBRSVFMCVBNiVCRSUyMCVFMCVBNiVBOCVFMCVBNiVBNiVFMCVBNyU4MCVFMCVBNiVCMCUyMCVFMCVBNiVBRSVFMCVBNiVCRSVFMCVBNiU5RCVFMCVBNiVCRiUyMChQYWRtYSUyME5hZGlyJTIwTWFqaGkpJTIwJUUwJUE2JUFFJUUwJUE2JUJFJUUwJUE2JUE4JUUwJUE2JUJGJUUwJUE2JTk1JTIwJUUwJUE2JUFDJUUwJUE2JUE4JUUwJUE3JThEJUUwJUE2JUE2JUUwJUE3JThEJUUwJUE2JUFGJUUwJUE3JThCJUUwJUE2JUFBJUUwJUE2JUJFJUUwJUE2JUE3JUUwJUE3JThEJUUwJUE2JUFGJUUwJUE2JUJFJUUwJUE2JUFGJUUwJUE2JUJDJTIwKE1hbmlrJTIwQmFuZG9wYWRoeWF5KXxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&q=60&w=600', description: "à¦ªà¦¦à§à¦®à¦¾ à¦¨à¦¦à§€à¦° à¦¤à§€à¦°à§‡à¦° à¦œà§‡à¦²à§‡à¦¦à§‡à¦° à¦œà§€à¦¬à¦¨ à¦¸à¦‚à¦—à§à¦°à¦¾à¦®à§‡à¦° à¦•à¦¾à¦¹à¦¿à¦¨à§€à¥¤ à¦®à¦¾à¦¨à¦¿à¦• à¦¬à¦¨à§à¦¦à§à¦¯à§‹à¦ªà¦¾à¦§à§à¦¯à¦¾à¦¯à¦¼à§‡à¦° à¦à¦‡ à¦•à¦¾à¦²à¦œà¦¯à¦¼à§€ à¦‰à¦ªà¦¨à§à¦¯à¦¾à¦¸à¦Ÿà¦¿ à¦¬à¦¾à¦‚à¦²à¦¾ à¦¸à¦¾à¦¹à¦¿à¦¤à§à¦¯à§‡à¦° à¦à¦• à¦…à¦®à§‚à¦²à§à¦¯ à¦¸à¦®à§à¦ªà¦¦à¥¤ A timeless tale of fishermen's struggles along the Padma River." },
            { _id: '9', title: 'à¦²à¦¾à¦²à¦¸à¦¾à¦²à§ (Lalsalu)', author: 'à¦¸à§ˆà¦¯à¦¼à¦¦ à¦“à¦¯à¦¼à¦¾à¦²à§€à¦‰à¦²à§à¦²à¦¾à¦¹ (Syed Waliullah)', category: 'Bangla Literature', rating: 4.6, reviews: 734, price: 6.99, oldPrice: null, discount: 0, image: 'https://images.unsplash.com/photo-1707547272252-0c00ea387302?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8JUUwJUE2JUIyJUUwJUE2JUJFJUUwJUE2JUIyJUUwJUE2JUI4JUUwJUE2JUJFJUUwJUE2JUIyJUUwJUE3JTgxJTIwKExhbHNhbHUpJTIwJUUwJUE2JUI4JUUwJUE3JTg4JUUwJUE2JUFGJUUwJUE2JUJDJUUwJUE2JUE2JTIwJUUwJUE2JTkzJUUwJUE2JUFGJUUwJUE2JUJDJUUwJUE2JUJFJUUwJUE2JUIyJUUwJUE3JTgwJUUwJUE2JTg5JUUwJUE2JUIyJUUwJUE3JThEJUUwJUE2JUIyJUUwJUE2JUJFJUUwJUE2JUI5JTIwKFN5ZWQlMjBXYWxpdWxsfGVufDB8fDB8fHww&auto=format&fit=crop&q=60&w=600', description: "à¦—à§à¦°à¦¾à¦®à§€à¦£ à¦¬à¦¾à¦‚à¦²à¦¾à¦° à¦§à¦°à§à¦®à§€à¦¯à¦¼ à¦•à§à¦¸à¦‚à¦¸à§à¦•à¦¾à¦° à¦à¦¬à¦‚ à¦¸à¦®à¦¾à¦œà§‡à¦° à¦…à¦¨à§à¦§à¦•à¦¾à¦° à¦¦à¦¿à¦•à¦—à§à¦²à§‹ à¦¤à§à¦²à§‡ à¦§à¦°à¦¾ à¦à¦•à¦Ÿà¦¿ à¦¶à¦•à§à¦¤à¦¿à¦¶à¦¾à¦²à§€ à¦‰à¦ªà¦¨à§à¦¯à¦¾à¦¸à¥¤ A powerful novel exposing religious superstitions and social darkness in rural Bengal." },
            { _id: '10', title: "à¦¹à§à¦®à¦¾à¦¯à¦¼à§‚à¦¨ à¦†à¦¹à¦®à§‡à¦¦à§‡à¦° à¦—à¦²à§à¦ª à¦¸à¦‚à¦•à¦²à¦¨ (Humayun Ahmed's Short Stories)", author: 'à¦¹à§à¦®à¦¾à¦¯à¦¼à§‚à¦¨ à¦†à¦¹à¦®à§‡à¦¦ (Humayun Ahmed)', category: 'Bangla Literature', rating: 4.8, reviews: 2156, price: 9.99, oldPrice: 12.99, discount: 23, image: 'https://images.unsplash.com/photo-1665306376180-3349308d5a38?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8JUUwJUE2JUI5JUUwJUE3JTgxJUUwJUE2JUFFJUUwJUE2JUJFJUUwJUE2JUFGJUUwJUE2JUJDJUUwJUE3JTgyJUUwJUE2JUE4JTIwJUUwJUE2JTg2JUUwJUE2JUI5JUUwJUE2JUFFJUUwJUE3JTg3JUUwJUE2JUE2JUUwJUE3JTg3JUUwJUE2JUIwJTIwJUUwJUE2JTk3JUUwJUE2JUIyJUUwJUE3JThEJUUwJUE2JUFBJTIwJUUwJUE2JUI4JUUwJUE2JTgyJUUwJUE2JTk1JUUwJUE2JUIyJUUwJUE2JUE4JTIwKEh1bWF5dW4lMjBBaG1lZCdzJTIwU2hvcnQlMjBTdG9yaWVzKSUyMCVFMCVBNiVCOSVFMCVBNyU4MSVFMCVBNiVBRSVFMCVBNiVCRSVFMCVBNiVBRiVFMCVBNiVCQyVFMCVBNyU4MiVFMCVBNiVBOCUyMCVFMCVBNiU4NiVFMCVBNiVCOSVFMCVBNiVBRSVFMCVBNyU4NyVFMCVBNiVBNiUyMChIdW1heXVuJTIwQWhtfGVufDB8fDB8fHww&auto=format&fit=crop&q=60&w=600', description: "à¦†à¦§à§à¦¨à¦¿à¦• à¦¬à¦¾à¦‚à¦²à¦¾ à¦¸à¦¾à¦¹à¦¿à¦¤à§à¦¯à§‡à¦° à¦…à¦¨à§à¦¯à¦¤à¦® à¦œà¦¨à¦ªà§à¦°à¦¿à¦¯à¦¼ à¦²à§‡à¦–à¦• à¦¹à§à¦®à¦¾à¦¯à¦¼à§‚à¦¨ à¦†à¦¹à¦®à§‡à¦¦à§‡à¦° à¦¨à¦¿à¦°à§à¦¬à¦¾à¦šà¦¿à¦¤ à¦—à¦²à§à¦ª à¦¸à¦‚à¦•à¦²à¦¨à¥¤ à¦®à¦§à§à¦¯à¦¬à¦¿à¦¤à§à¦¤ à¦œà§€à¦¬à¦¨à§‡à¦° à¦†à¦¨à¦¨à§à¦¦-à¦¬à§‡à¦¦à¦¨à¦¾à¦° à¦…à¦¸à¦¾à¦§à¦¾à¦°à¦£ à¦šà¦¿à¦¤à§à¦°à¦¾à¦¯à¦¼à¦£à¥¤ A collection of beloved stories capturing middle-class life in Bangladesh." },
            { _id: '11', title: 'à¦…à¦ªà¦°à¦¾à¦œà§‡à¦¯à¦¼ à¦¬à¦¾à¦‚à¦²à¦¾ (Aparajey Bangla)', author: 'à¦¶à¦¹à§€à¦¦à§à¦² à¦œà¦¹à¦¿à¦° (Shahidul Zahir)', category: 'Bangla Literature', rating: 4.5, reviews: 612, price: 8.50, oldPrice: null, discount: 0, image: 'https://images.unsplash.com/photo-1722871514680-0db7050f7a9b?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxiYW5nbGFkZXNoJTIwaW5kZXBlbmRlbmNlfGVufDF8fHx8MTc2MTkyNzk3Mnww&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', description: "à¦†à¦§à§à¦¨à¦¿à¦• à¦¬à¦¾à¦‚à¦²à¦¾à¦¦à§‡à¦¶à§‡à¦° à¦¸à¦®à¦¾à¦œ à¦“ à¦°à¦¾à¦œà¦¨à§€à¦¤à¦¿à¦° à¦à¦•à¦Ÿà¦¿ à¦—à¦­à§€à¦° à¦¬à¦¿à¦¶à§à¦²à§‡à¦·à¦£à¥¤ à¦¸à§à¦¬à¦¾à¦§à§€à¦¨à¦¤à¦¾ à¦ªà¦°à¦¬à¦°à§à¦¤à§€ à¦¬à¦¾à¦‚à¦²à¦¾à¦¦à§‡à¦¶à§‡à¦° à¦šà¦¾à¦²à¦šà¦¿à¦¤à§à¦°à¥¤ A deep analysis of modern Bangladeshi society and politics in the post-independence era." },
            { _id: '12', title: 'à¦šà¦¾à¦à¦¦à§‡à¦° à¦ªà¦¾à¦¹à¦¾à¦¡à¦¼ (Chander Pahar)', author: 'à¦¬à¦¿à¦­à§‚à¦¤à¦¿à¦­à§‚à¦·à¦£ à¦¬à¦¨à§à¦¦à§à¦¯à§‹à¦ªà¦¾à¦§à§à¦¯à¦¾à¦¯à¦¼ (Bibhutibhushan Bandyopadhyay)', category: 'Bangla Literature', rating: 4.8, reviews: 1842, price: 7.99, oldPrice: 9.99, discount: 20, image: 'https://images.unsplash.com/photo-1755357862944-90931d405e20?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxhZnJpY2FuJTIwYWR2ZW50dXJlfGVufDF8fHx8MTc2MTkyNzk3Mnww&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', description: "à¦°à§‹à¦®à¦¾à¦žà§à¦šà¦•à¦° à¦…à¦­à¦¿à¦¯à¦¾à¦¨ à¦“ à¦¸à¦¾à¦¹à¦¸à¦¿à¦•à¦¤à¦¾à¦° à¦—à¦²à§à¦ªà¥¤ à¦†à¦«à§à¦°à¦¿à¦•à¦¾à¦° à¦ªà¦Ÿà¦­à§‚à¦®à¦¿à¦¤à§‡ à¦°à¦šà¦¿à¦¤ à¦à¦‡ à¦…à¦¬à¦¿à¦¸à§à¦®à¦°à¦£à§€à¦¯à¦¼ à¦‰à¦ªà¦¨à§à¦¯à¦¾à¦¸à¥¤ An epic adventure story set in the African wilderness, filled with courage and exploration." },
            { _id: '13', title: 'à¦•à¦¬à¦¿ (Kobi)', author: 'à¦¤à¦¾à¦°à¦¾à¦¶à¦™à§à¦•à¦° à¦¬à¦¨à§à¦¦à§à¦¯à§‹à¦ªà¦¾à¦§à§à¦¯à¦¾à¦¯à¦¼ (Tarashankar Bandyopadhyay)', category: 'Bangla Literature', rating: 4.6, reviews: 923, price: 6.50, oldPrice: null, discount: 0, image: 'https://images.unsplash.com/photo-1542550826-15ab433fc407?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxwb2V0JTIwd3JpdGluZ3xlbnwxfHx8fDE3NjE5Mjc5NzJ8MA&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', description: "à¦à¦•à¦œà¦¨ à¦—à§à¦°à¦¾à¦®à§€à¦£ à¦•à¦¬à¦¿à¦° à¦œà§€à¦¬à¦¨ à¦¸à¦‚à¦—à§à¦°à¦¾à¦® à¦“ à¦¶à¦¿à¦²à§à¦ªà¦šà§‡à¦¤à¦¨à¦¾à¦° à¦…à¦ªà§‚à¦°à§à¦¬ à¦•à¦¾à¦¹à¦¿à¦¨à§€à¥¤ The poignant story of a rural poet's struggle and artistic consciousness." },
            { _id: '14', title: "à¦°à¦¬à§€à¦¨à§à¦¦à§à¦°à¦¨à¦¾à¦¥à§‡à¦° à¦•à¦¬à¦¿à¦¤à¦¾ à¦¸à¦‚à¦—à§à¦°à¦¹ (Rabindranath's Poetry Collection)", author: 'à¦°à¦¬à§€à¦¨à§à¦¦à§à¦°à¦¨à¦¾à¦¥ à¦ à¦¾à¦•à§à¦° (Rabindranath Tagore)', category: 'Bangla Literature', rating: 4.9, reviews: 3456, price: 11.99, oldPrice: 14.99, discount: 20, image: 'https://images.unsplash.com/photo-1649682303298-24017e5dedb4?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHx0YWdvcmUlMjBwb2V0cnl8ZW58MXx8fHwxNzYxOTI3OTczfDA&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', description: "à¦¬à¦¿à¦¶à§à¦¬à¦•à¦¬à¦¿ à¦°à¦¬à§€à¦¨à§à¦¦à§à¦°à¦¨à¦¾à¦¥ à¦ à¦¾à¦•à§à¦°à§‡à¦° à¦…à¦®à¦° à¦•à¦¬à¦¿à¦¤à¦¾à¦¸à¦®à§‚à¦¹à§‡à¦° à¦¨à¦¿à¦°à§à¦¬à¦¾à¦šà¦¿à¦¤ à¦¸à¦‚à¦•à¦²à¦¨à¥¤ à¦—à§€à¦¤à¦¾à¦žà§à¦œà¦²à¦¿, à¦¸à§‹à¦¨à¦¾à¦° à¦¤à¦°à§€ à¦¸à¦¹ à¦¬à¦¿à¦–à§à¦¯à¦¾à¦¤ à¦•à¦¬à¦¿à¦¤à¦¾à¦—à§à¦²à§‹à¥¤ Selected collection of immortal poems by the world poet, including Gitanjali and Sonar Tari." },
            { _id: '15', title: 'à¦¬à¦¨à¦²à¦¤à¦¾ à¦¸à§‡à¦¨ (Banalata Sen)', author: 'à¦œà§€à¦¬à¦¨à¦¾à¦¨à¦¨à§à¦¦ à¦¦à¦¾à¦¶ (Jibanananda Das)', category: 'Bangla Literature', rating: 4.7, reviews: 1567, price: 5.99, oldPrice: null, discount: 0, image: 'https://images.unsplash.com/photo-1602793778401-d5ddab8febd5?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxiZW5nYWxpJTIwbmF0dXJlfGVufDF8fHx8MTc2MTkyNzk3M3ww&ixlib.rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', description: "à¦†à¦§à§à¦¨à¦¿à¦• à¦¬à¦¾à¦‚à¦²à¦¾ à¦•à¦¬à¦¿à¦¤à¦¾à¦° à¦…à¦¨à§à¦¯à¦¤à¦® à¦¶à§à¦°à§‡à¦·à§à¦  à¦•à¦¬à¦¿ à¦œà§€à¦¬à¦¨à¦¾à¦¨à¦¨à§à¦¦ à¦¦à¦¾à¦¶à§‡à¦° à¦¬à¦¿à¦–à§à¦¯à¦¾à¦¤ à¦•à¦¬à¦¿à¦¤à¦¾ à¦¸à¦‚à¦•à¦²à¦¨à¥¤ à¦°à§‚à¦ªà¦¸à§€ à¦¬à¦¾à¦‚à¦²à¦¾à¦° à¦…à¦¨à§à¦ªà¦® à¦¬à¦°à§à¦£à¦¨à¦¾à¥¤ Famous poetry collection by one of the greatest modern Bengali poets, depicting the beauty of Bengal." },
            { _id: '16', title: 'à¦†à¦°à¦£à§à¦¯à¦• (Aranyak)', author: 'à¦¬à¦¿à¦­à§‚à¦¤à¦¿à¦­à§‚à¦·à¦£ à¦¬à¦¨à§à¦¦à§à¦¯à§‹à¦ªà¦¾à¦§à§à¦¯à¦¾à¦¯à¦¼ (Bibhutibhushan Bandyopadhyay)', category: 'Bangla Literature', rating: 4.8, reviews: 1234, price: 8.99, oldPrice: null, discount: 0, image: 'https://images.unsplash.com/photo-1702411995197-7852206e92f8?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxmb3Jlc3QlMjB3aWxkZXJuZXNzfGVufDF8fHx8MTc2MTkyNzk3NHww&ixlib.rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', description: "à¦¬à¦¿à¦¹à¦¾à¦°à§‡à¦° à¦œà¦™à§à¦—à¦²à§‡ à¦à¦•à¦œà¦¨ à¦¯à§à¦¬à¦•à§‡à¦° à¦œà§€à¦¬à¦¨à¦¯à¦¾à¦¤à§à¦°à¦¾ à¦“ à¦ªà§à¦°à¦•à§ƒà¦¤à¦¿ à¦ªà§à¦°à§‡à¦®à§‡à¦° à¦…à¦¨à§à¦ªà¦® à¦•à¦¾à¦¹à¦¿à¦¨à§€à¥¤ A beautiful tale of a young man's life in the forests of Bihar and his love for nature." },
            { _id: '17', title: 'Foundation', author: 'Isaac Asimov', category: 'Science Fiction', rating: 4.6, reviews: 8974, price: 15.99, oldPrice: 18.99, discount: 16, image: 'https://images.unsplash.com/photo-1658999194718-c59895703e2e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxnYWxhY3RpYyUyMGVtcGlyZXxlbnwxfHx8fDE3NjE5Mjc5NzR8MA&ixlib.rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', description: "The epic saga of humanity's galactic empire. Hari Seldon's psychohistory predicts the fall of the Empire and the coming Dark Age." },
            { _id: '18', title: 'Neuromancer', author: 'William Gibson', category: 'Science Fiction', rating: 4.5, reviews: 5632, price: 14.99, oldPrice: null, discount: 0, image: 'https://images.unsplash.com/photo-1741795990583-d4115c018da2?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxkaWdpdGFsJTIwbWF0cml4fGVufDF8fHx8MTc2MTg4MTQzMXww&ixlib.rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', description: "The novel that launched the cyberpunk genre. Enter the matrix of cyberspace where AI and human consciousness collide." },
            { _id: '19', title: 'The Left Hand of Darkness', author: 'Ursula K. Le Guin', category: 'Science Fiction', rating: 4.7, reviews: 4821, price: 13.99, oldPrice: 16.99, discount: 18, image: 'https://images.unsplash.com/photo-1655509206649-a63396bed840?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxhbGllbiUyMHBsYW5ldHxlbnwxfHx8fDE3NjE5Mjc5NzV8MA&ixlib.rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', description: "A groundbreaking exploration of gender and society on the alien world of Gethen. Winner of Hugo and Nebula Awards." },
            { _id: '20', title: 'Hyperion', author: 'Dan Simmons', category: 'Science Fiction', rating: 4.8, reviews: 6543, price: 16.99, oldPrice: null, discount: 0, image: 'https://images.unsplash.com/photo-1703925155012-ad6ed0f1624e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzcGFjZSUyMG9wZXJhfGVufDF8fHx8MTc2MTkyNzk3NXww&ixlib.rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', description: "Seven pilgrims journey to the mysterious world of Hyperion, each carrying their own dark secrets and desperate hopes." },
            { _id: '21', title: "Ender's Game", author: 'Orson Scott Card', category: 'Science Fiction', rating: 4.6, reviews: 12547, price: 12.99, oldPrice: 15.99, discount: 19, image: 'https://images.unsplash.com/photo-1577594948710-b232c7d9c456?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzcGFjZSUyMGJhdHRsZXxlbnwxfHx8fDE3NjE5Mjc5NzV8MA&ixlib.rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', description: "Brilliant children are trained to fight in Earth's war against alien invaders. A coming-of-age story in space." },
            { _id: '22', title: 'The Martian', author: 'Andy Weir', category: 'Science Fiction', rating: 4.7, reviews: 9876, price: 14.99, oldPrice: null, discount: 0, image: 'https://images.unsplash.com/photo-1603031532585-34192bc4489f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxtYXJzJTIwYXN0cm9uYXV0fGVufDF8fHx8MTc2MTkyNzk3Nnww&ixlib.rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', description: "Stranded on Mars, an astronaut must use his ingenuity to survive and signal Earth for rescue. Hard science fiction at its best." },
            { _id: '23', title: 'Pride and Prejudice', author: 'Jane Austen', category: 'Classic Literature', rating: 4.6, reviews: 15234, price: 9.99, oldPrice: 12.99, discount: 23, image: 'https://images.unsplash.com/photo-1589200412802-8a0fc9ce8875?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxyZWdlbmN5JTIwZW5nbGFuZHxlbnwxfHx8fDE3NjE5Mjc5Nzd8MA&ixlib.rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', description: "A witty and romantic novel about Elizabeth Bennet and Mr. Darcy. A timeless exploration of love, class, and social expectations." },
            { _id: '24', title: 'The Great Gatsby', author: 'F. Scott Fitzgerald', category: 'Classic Literature', rating: 4.4, reviews: 11867, price: 10.99, oldPrice: null, discount: 0, image: 'https://images.unsplash.com/photo-1611416630403-545aab48d81e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxqYXp6JTIwYWdlfGVufDF8fHx8MTc2MTkyNzk3N3ww&ixlib.rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', description: "The quintessential American novel about the Jazz Age, the American Dream, and the tragic Jay Gatsby." },
            { _id: '25', title: 'Jane Eyre', author: 'Charlotte BrontÃ«', category: 'Classic Literature', rating: 4.5, reviews: 8934, price: 11.99, oldPrice: 14.99, discount: 20, image: 'https://images.unsplash.com/photo-1650787846803-6e3ec8778f15?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHx2aWN0b3JpYW4lMjBnb3RoaWN8ZW58MXx8fHwxNzYxOTI3OTc3fDA&ixlib.rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', description: "The story of an orphaned governess who faces hardship and finds love. A powerful tale of independence and moral strength." },
            { _id: '26', title: 'Wuthering Heights', author: 'Emily BrontÃ«', category: 'Classic Literature', rating: 4.3, reviews: 7234, price: 10.50, oldPrice: null, discount: 0, image: 'https://images.unsplash.com/photo-1630075362810-5940a3d2fa79?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxlbmdsaXNoJTIwbW9vcnN8ZW58MXx8fHwxNzYxOTI3OTc3fDA&ixlib.rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral', description: "A dark and passionate tale of love and revenge set on the Yorkshire moors. The tumultuous relationship between Heathcliff and Catherine." }
        ];

        let cart = getCartFromStorage();
        let currentFilter = 'All Categories';
        let currentBookForModal = null;
        let html5QrCode;

        // Bootstrap Modal Instances
        let bookModal, scannerModal, cartModal, alertModal;

        // DOM Elements
        const cartCountBadge = document.getElementById('cartCountBadge');
        const cartItemsList = document.getElementById('cartItemsList');
        const cartTotal = document.getElementById('cartTotal');
        const clearCartBtn = document.getElementById('clearCartBtn');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const emptyCartMsg = document.getElementById('emptyCartMsg');
        const userNameDisplay = document.getElementById('userNameDisplay');
        const scannerModalEl = document.getElementById('scannerModal');
        const qrScanResult = document.getElementById('qr-scan-result');


        // --- Page Load Function ---
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Bootstrap Modals
            bookModal = new bootstrap.Modal(document.getElementById('bookModal'));
            scannerModal = new bootstrap.Modal(scannerModalEl);
            cartModal = new bootstrap.Modal(document.getElementById('cartModal'));
            alertModal = new bootstrap.Modal(document.getElementById('alertModal'));

            // Populate page content
            populateCategoryFilter();
            filterAndDisplayBooks(currentFilter);
            checkLoginStatus();
            updateCartUI();

            // Add Event Listeners
            document.getElementById('openScannerBtn').addEventListener('click', (e) => {
                e.preventDefault(); // Stop link behavior
                startScanner();
            });
            document.getElementById('cartBtn').addEventListener('click', (e) => {
                e.preventDefault(); // Stop link behavior
                openCartModal();
            });
            document.getElementById('clearCartBtn').addEventListener('click', clearCart);

            // Stop scanner when modal is hidden
            scannerModalEl.addEventListener('hidden.bs.modal', stopScanner);
        });
        
        // --- Custom Alert Function ---
        function customAlert(message) {
            document.getElementById('alertMessage').textContent = message;
            alertModal.show();
        }

        // --- LOGIN STATUS FUNCTION ---
        function checkLoginStatus() {
            const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
            if (loggedInUser && loggedInUser.name) {
                userNameDisplay.textContent = loggedInUser.name;
            } else {
                userNameDisplay.textContent = 'Demo User';
            }
        }

        // --- Category Filter Functions ---
        function populateCategoryFilter() {
            const categories = ['All Categories', ...new Set(allBooks.map(book => book.category))];
            const dropdownMenu = document.getElementById('categoryDropdownMenu');
            dropdownMenu.innerHTML = ''; 

            categories.forEach(category => {
                const item = document.createElement('li');
                const link = document.createElement('a');
                link.className = 'dropdown-item';
                link.href = '#';
                link.textContent = category;
                link.onclick = (e) => {
                    e.preventDefault(); 
                    currentFilter = category;
                    document.getElementById('categoryDropdownButton').textContent = category; 
                    filterAndDisplayBooks(currentFilter); 
                };
                item.appendChild(link);
                dropdownMenu.appendChild(item);
            });
        }

        function filterAndDisplayBooks(category) {
            let booksToDisplay;
            if (category === 'All Categories') {
                booksToDisplay = allBooks;
            } else {
                booksToDisplay = allBooks.filter(book => book.category === category);
            }
            displayBooks(booksToDisplay);
        }

        // --- Book Display Functions ---
        function displayBooks(books) {
            const grid = document.getElementById('book-grid');
            grid.innerHTML = ''; 

            document.getElementById('book-count').textContent = `Showing ${books.length} of ${allBooks.length} books`;

            books.forEach(book => {
                const discountHTML = book.discount ? `<div class="discount-badge">-${book.discount}%</div>` : '';
                const oldPriceHTML = book.oldPrice ? `<span class="price-old">$${book.oldPrice.toFixed(2)}</span>` : '';
                
                const cardHTML = `
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="book-card">
                        
                        <div class="book-card-img-container" onclick="openBookModal('${book._id}')">
                            <img src="${book.image}" alt="${book.title}" onerror="this.src='https://placehold.co/400x600/eee/ccc?text=Image+Not+Found'">
                            ${discountHTML}
                            <div class="category-badge">${book.category}</div>
                        </div>

                        <div class="book-card-body">
                            <h5 class="book-title" title="${book.title}">${book.title}</h5>
                            <p class="book-author" title="${book.author}">${book.author}</p>
                            
                            <div class="d-flex align-items-center mb-2">
                                <span class="rating-stars">${renderStars(book.rating)}</span>
                                <span class="review-count">(${book.reviews.toLocaleString()})</span>
                            </div>
                            
                            <div class="mb-3">
                                <span class="price-new">$${book.price.toFixed(2)}</span>
                                ${oldPriceHTML}
                            </div>
                            
                            <button class="btn btn-dark w-100" onclick="handleAddToCartClick('${book._id}', event)">
                                <i class="bi bi-cart-plus"></i> Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
                `;
                grid.innerHTML += cardHTML;
            });
        }

        function renderStars(rating) {
            let stars = '';
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 !== 0; // Check for decimal
            const emptyStars = 5 - Math.ceil(rating);

            for (let i = 0; i < fullStars; i++) stars += '<i class="bi bi-star-fill"></i> ';
            if (halfStar) stars += '<i class="bi bi-star-half"></i> ';
            for (let i = 0; i < emptyStars; i++) stars += '<i class="bi bi-star"></i> ';
            return stars;
        }

        // --- Modal Functions ---
        function openBookModal(bookId) {
            const book = allBooks.find(b => b._id === bookId);
            if (!book) return;

            currentBookForModal = book; // Store book for modal's Add to Cart button

            document.getElementById('modalBookTitle').textContent = book.title;
            document.getElementById('modalBookImage').src = book.image; 
            document.getElementById('modalBookAuthor').textContent = book.author;
            document.getElementById('modalBookCategory').textContent = book.category;
            document.getElementById('modalBookRating').innerHTML = `${renderStars(book.rating)} <strong class="ms-1">${book.rating}</strong>`;
            document.getElementById('modalBookReviews').textContent = `(${book.reviews.toLocaleString()} reviews)`;
            document.getElementById('modalBookDescription').textContent = book.description || `Details for "${book.title}" are not available yet.`;
            document.getElementById('modalBookPriceNew').textContent = `$${book.price.toFixed(2)}`;
            
            const priceOldEl = document.getElementById('modalBookPriceOld');
            if (book.oldPrice) {
                priceOldEl.textContent = `$${book.oldPrice.toFixed(2)}`;
                priceOldEl.style.display = 'inline';
            } else {
                priceOldEl.style.display = 'none';
            }
            
            // Link modal button to the correct book
            document.getElementById('modalAddToCartButton').onclick = () => {
                addToCart(currentBookForModal); // Use the stored book object
                bookModal.hide(); 
            };
            
            bookModal.show();
        }

        // --- QR Scanner Functions ---
        function startScanner() {
            if (!html5QrCode) {
                html5QrCode = new Html5Qrcode("qr-reader");
            }
            scannerModal.show();
            qrScanResult.textContent = 'Scanning...';
            
            html5QrCode.start(
                { facingMode: "environment" }, 
                { fps: 10, qrbox: { width: 250, height: 250 } },
                onScanSuccess,
                onScanFailure
            ).catch(err => {
                console.error("QR Scanner start failed:", err);
                qrScanResult.textContent = 'Failed to start scanner. Please give camera permission.';
                customAlert('Error: Could not start camera. Please grant permission.');
            });
        }

        function stopScanner() {
            if (html5QrCode && html5QrCode.isScanning) {
                html5QrCode.stop().then(() => {
                    console.log("QR Scanner stopped.");
                }).catch(err => {
                    console.error("QR Scanner stop failed:", err);
                });
            }
        }

        function onScanSuccess(decodedText, decodedResult) {
            stopScanner();
            scannerModal.hide();
            const book = allBooks.find(b => b._id === decodedText);
            if (book) {
                openBookModal(book._id);
            } else {
                customAlert(`Book with ID "${decodedText}" not found in our database.`);
            }
        }

        function onScanFailure(error) {
            qrScanResult.textContent = 'Scanning... (Align QR code within the box)';
        }


        // --- Cart Logic ---
        function handleAddToCartClick(bookId, event) {
            if (event) {
                event.stopPropagation(); // Stop card click from opening modal
            }
            const book = allBooks.find(b => b._id === bookId);
            addToCart(book);
        }

        function addToCart(book) {
            if (!book) return;
            
            const existingItem = cart.find(item => item._id === book._id);
            if (existingItem) {
                customAlert('This book is already in your cart.');
            } else {
                cart.push({ ...book, quantity: 1 });
                saveCartToStorage();
                updateCartUI();
                customAlert('Book added to cart!');
            }
        }

        function removeFromCart(bookId) {
            cart = cart.filter(item => item._id !== bookId);
            saveCartToStorage();
            updateCartUI();
        }

        function clearCart() {
            cart = [];
            saveCartToStorage();
            updateCartUI();
        }

        function openCartModal() {
            updateCartUI(); // Refresh cart contents every time it's opened
            cartModal.show();
        }

        function updateCartUI() {
            // Update Badge
            if (cart.length > 0) {
                cartCountBadge.textContent = cart.length;
                cartCountBadge.style.display = 'block';
                // emptyCartMsg.style.display = 'none'; // Controlled in list update
                clearCartBtn.disabled = false;
                checkoutBtn.disabled = false;
            } else {
                cartCountBadge.style.display = 'none';
                // emptyCartMsg.style.display = 'block'; // Controlled in list update
                clearCartBtn.disabled = true;
                checkoutBtn.disabled = true;
            }
            
            // Update Cart Modal List
            cartItemsList.innerHTML = ''; // Clear list
            if (cart.length > 0) {
                cart.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'd-flex align-items-center justify-content-between py-2 border-bottom';
                    itemElement.innerHTML = `
                        <div class="d-flex align-items-center" style="min-width: 0;">
                            <img src="${item.image}" alt="${item.title}" style="width: 50px; height: 70px; object-fit: cover; border-radius: 4px;">
                            <div class="ms-3" style="min-width: 0;">
                                <h6 class="mb-0 text-truncate" title="${item.title}">${item.title}</h6>
                                <small class="text-muted">$${item.price.toFixed(2)}</small>
                            </div>
                        </div>
                        <button class="btn btn-sm btn-outline-danger remove-item-btn" data-id="${item._id}">
                            <i class="bi bi-trash-fill"></i>
                        </button>
                    `;
                    cartItemsList.appendChild(itemElement);
                });
            } else {
                cartItemsList.innerHTML = '<p id="emptyCartMsg" class="text-center text-muted py-4">Your cart is empty.</p>';
            }

            // Add event listeners to new remove buttons
            document.querySelectorAll('.remove-item-btn').forEach(button => {
                button.addEventListener('click', () => {
                    removeFromCart(button.dataset.id);
                });
            });
            
            // Update Total
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            cartTotal.textContent = `$${total.toFixed(2)}`;
        }

    </script>

</body>
</html>

